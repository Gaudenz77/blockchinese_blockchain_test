<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Blockchain App</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

</head>
<body>
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-6 mt-5">
                <form id="createBlockForm">
                    <div class="mb-3">
                        <label for="blockData" class="form-label">Block Data:</label>
                        <textarea class="form-control" id="blockData" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="blockValue" class="form-label">Block Value (Currency):</label>
                        <input type="text" class="form-control" id="blockValue" required>
                    </div>
                    <button class="btn btn-success mt-2 p-3" type="button" onclick="createBlockchain()">
                        Create Blockchain
                    </button>
                </form>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-10">
                <!-- Display Blockchain -->
                <div class="table table-responsive">
                    <div id="blockchainDisplay" class="mt-3"></div>
                </div>
                
            </div>
        </div>
    </div>




  <!-- Include CryptoJS via CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>



<script>
  const sha256 = CryptoJS.SHA256;

  class Block {
    constructor(index, timestamp, data, previousHash = '') {
      this.index = index;
      this.timestamp = timestamp;
      this.data = data;
      this.previousHash = previousHash;
      this.hash = this.calculateHash();
    }

    calculateHash() {
      return sha256(
        this.index +
        this.timestamp +
        JSON.stringify(this.data) +
        this.previousHash
      ).toString();
    }

    static fromObject(obj) {
      const newBlock = new Block(obj.index, obj.timestamp, obj.data, obj.previousHash);
      newBlock.hash = obj.hash;
      return newBlock;
    }
  }

  class Blockchain {
    constructor() {
      this.chain = this.retrieveBlockchain() || [this.createGenesisBlock()];
    }

    createGenesisBlock() {
      return new Block(0, new Date().toLocaleString(), 'Genesis Block', '0');
    }

    getLatestBlock() {
      return this.chain[this.chain.length - 1];
    }

    addBlock(newBlock) {
      newBlock.previousHash = this.getLatestBlock().hash;
      newBlock.hash = newBlock.calculateHash();
      this.chain.push(newBlock);
      this.saveBlockchain();
    }

    saveBlockchain() {
      localStorage.setItem('blockchain', JSON.stringify(this.chain));
    }

    retrieveBlockchain() {
      const storedBlockchain = localStorage.getItem('blockchain');
      return storedBlockchain ? JSON.parse(storedBlockchain).map(Block.fromObject) : null;
    }

    static fromObject(obj) {
      const newBlockchain = new Blockchain();
      newBlockchain.chain = obj.chain.map(Block.fromObject);
      return newBlockchain;
    }
  }

  const myBlockchain = new Blockchain();

  function createBlockchain() {
    const blockData = document.getElementById('blockData').value;
    const blockValue = document.getElementById('blockValue').value;
    const newBlock = new Block(myBlockchain.chain.length, new Date().toLocaleString(), { data: blockData, value: blockValue });
    myBlockchain.addBlock(newBlock);
    displayBlockchain();
  }

  function displayBlockchain() {
    const blockchainDisplay = document.getElementById('blockchainDisplay');
    blockchainDisplay.innerHTML = ''; // Clear previous display.

    // Create a table element with Bootstrap classes
    const table = document.createElement('table');
    table.className = 'table table-striped-columns';

    // Create table header
    const headerRow = table.insertRow(0);
    const headers = ['Block Number', 'Timestamp', 'Data', 'Hash', 'Previous Hash'];
    headers.forEach(headerText => {
      const header = document.createElement('th');
      header.textContent = headerText;
      headerRow.appendChild(header);
    });

    // Populate the table with blockchain data
    for (const block of myBlockchain.chain) {
      const row = table.insertRow(-1);
      const rowData = [block.index, block.timestamp, JSON.stringify(block.data), block.hash, block.previousHash];

      rowData.forEach((data, index) => {
        const cell = row.insertCell(index);
        cell.textContent = data;
      });
    }

    // Append the table to the display element
    blockchainDisplay.appendChild(table);
  }

  // Display the blockchain on page load
  displayBlockchain();
</script>
</body>
</html>
